<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Maven," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="Maven学习笔记1. 是什么基于Java的跨平台项目管理及自动构建工具 2. 入门1234567891011121314&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt; &amp;lt;!--xml版本和编码方式 --&amp;gt;&amp;lt;!--project是pom.xml的根元素--&amp;gt;&amp;lt;project xmlns=&quot;http://maven.apache">
<meta name="keywords" content="Maven">
<meta property="og:type" content="article">
<meta property="og:title" content="Maven学习笔记">
<meta property="og:url" content="http://litianming1024.github.io/2018/08/23/Maven学习笔记/index.html">
<meta property="og:site_name" content="天明的小窝">
<meta property="og:description" content="Maven学习笔记1. 是什么基于Java的跨平台项目管理及自动构建工具 2. 入门1234567891011121314&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt; &amp;lt;!--xml版本和编码方式 --&amp;gt;&amp;lt;!--project是pom.xml的根元素--&amp;gt;&amp;lt;project xmlns=&quot;http://maven.apache">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://litianming1024.github.io/2018/08/23/Maven学习笔记/私服的用途.png">
<meta property="og:updated_time" content="2018-09-04T15:33:43.297Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Maven学习笔记">
<meta name="twitter:description" content="Maven学习笔记1. 是什么基于Java的跨平台项目管理及自动构建工具 2. 入门1234567891011121314&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt; &amp;lt;!--xml版本和编码方式 --&amp;gt;&amp;lt;!--project是pom.xml的根元素--&amp;gt;&amp;lt;project xmlns=&quot;http://maven.apache">
<meta name="twitter:image" content="http://litianming1024.github.io/2018/08/23/Maven学习笔记/私服的用途.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.2',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://litianming1024.github.io/2018/08/23/Maven学习笔记/"/>





  <title>Maven学习笔记 | 天明的小窝</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', '106956825-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">天明的小窝</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://litianming1024.github.io/2018/08/23/Maven学习笔记/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="天明">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="天明的小窝">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Maven学习笔记</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-23T01:17:35+08:00">
                2018-08-23
              </time>
            

            

            
          </span>

          

          
            
          

          
          
             <span id="/2018/08/23/Maven学习笔记/" class="leancloud_visitors" data-flag-title="Maven学习笔记">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Maven学习笔记"><a href="#Maven学习笔记" class="headerlink" title="Maven学习笔记"></a>Maven学习笔记</h1><h2 id="1-是什么"><a href="#1-是什么" class="headerlink" title="1. 是什么"></a>1. 是什么</h2><p>基于Java的跨平台项目管理及自动构建工具</p>
<h2 id="2-入门"><a href="#2-入门" class="headerlink" title="2. 入门"></a>2. 入门</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt; <span class="comment">&lt;!--xml版本和编码方式 --&gt;</span></div><div class="line"><span class="comment">&lt;!--project是pom.xml的根元素--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></div><div class="line"><span class="tag">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></div><div class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--modelVersion指定了POM模型的版本，Maven2和3只能为4.0.0--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--groupId定义项目属于哪个组，同项目所在的组织或者公司存在关联--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.demo<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--当前项目在组中唯一的ID--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-demo<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!--项目当前的版本号--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure>
<p>以上是Maven项目的基本配置文件，其余的各项配置写在<code>&lt;project&gt;&lt;/project&gt;</code>标签内</p>
<h2 id="3-坐标和依赖"><a href="#3-坐标和依赖" class="headerlink" title="3. 坐标和依赖"></a>3. 坐标和依赖</h2><h3 id="3-1-入门"><a href="#3-1-入门" class="headerlink" title="3.1 入门"></a>3.1 入门</h3><p>我们先看一组坐标定义<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.sonatype.nexus<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>nexus-indexer<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>jar<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></div></pre></td></tr></table></figure></p>
<ul>
<li>groupId：定义当前Maven项目隶属的实际目录，groupId不应该对应项目隶属的额组织或者公司，由于组织下会有许多实际项目，groupId只定义到组织级别，artifactId只能定义Maven项目（模块），实际项目将难以定义。</li>
<li>artifactId：定义实际项目中的一个Maven项目（模块），推荐使用实际项目名称作为artifactId的前缀</li>
<li>version：定义Maven项目所处的版本</li>
<li>packaging：定义Maven项目的打包方式，打包方式通常与所生成构件的文件扩展名对应，<strong>打包方式会影响到构建的生命周期</strong>，不定义packaging的时候，Maven会使用默认至jar。</li>
<li>classifier：定义构建输出的一些附属构建，附属构建与主构建对应。如上例中主构建是nexus-indexer-2.0.0jar，该项目可能还会通过使用一些插件生成如nexus-indexer-2.0.0-javadoc.jar、nexus-indexer-2.0.0-sources.jar这样一些附属构建，其中包含了Java文档和源代码。javadoc和sources就是这两个附属构建的classifier。<strong>不能直接定义项目的classifier，因为附属构件不是项目直接默认生成的，而是有附件的插件帮助生产</strong><br>上述5个元素中，groupId、artifactId、version是必须定义的，packaging是可选的（默认为jar），而classifier是不能直接定义的。<br>项目构件的文件名是与坐标相对应的额，<strong>一般的规则为artifactId-version[-classifier].packaging</strong>。</li>
</ul>
<h3 id="3-2-详解"><a href="#3-2-详解" class="headerlink" title="3.2 详解"></a>3.2 详解</h3><p>一个依赖可以包含如下的一些元素：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></div><div class="line">...</div><div class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>...<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>...<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>...<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>...<span class="tag">&lt;/<span class="name">type</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>...<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">optional</span>&gt;</span>...<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></div><div class="line">                ...</div><div class="line">                <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure></p>
<ul>
<li>type：依赖的类型，对应于项目坐标定义的packaging。大部分情况下，该元素不必声明，默认为jar。</li>
<li>scope：依赖范围，见<a href="#scope">3.2.1</a></li>
<li>optional：依赖是否可选</li>
<li>exclusions：排除依赖传递性</li>
</ul>
<h4 id="3-2-1-scope详解"><a href="#3-2-1-scope详解" class="headerlink" title="3.2.1 scope详解"></a><span id="scope">3.2.1 scope详解</span></h4><p>scope有以下几种以来范围：</p>
<ul>
<li>compile：编译依赖范围。如果没有指定默认使用该依赖范围。此种依赖范围对于编译、测试、运行三种classpath都有效，如spring-core。</li>
<li>test：测试依赖范围。对测试classpath有效，在编译主代码或者运行项目时无法使用此依赖，如Junit。</li>
<li>provided：已提供依赖范围。对编译和测试classpath有效，但在运行时无效。如servlet-api，编译和测试时需要，运行时由容器提供，不需要重复引用。</li>
<li>runtime：运行时依赖范围。对测试和运行有效,编译时无效。如JDBC驱动实现,项目代码只需要JDK提供的JDBC接口，只有在执行测试或者运行项目的时候才需要实现上述接口的具体JDBC驱动。</li>
<li><p>system：系统依赖范围。同provided，对编译和测试classpath有效，但在运行时无效，但是必须通过systempath元素显示指定依赖文件的路径。<strong>不可移植</strong>，可引用环境变量。如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.sql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jdbc-stdext<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>system<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">systemPath</span>&gt;</span>$&#123;java.hone&#125;/lib/rt.jar<span class="tag">&lt;/<span class="name">systemPath</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>import：导入依赖范围，只在dependencyManagement元素下有效，见<a href="#import">6.2.2</a></p>
</li>
</ul>
<h3 id="3-3-传递性依赖"><a href="#3-3-传递性依赖" class="headerlink" title="3.3 传递性依赖"></a>3.3 传递性依赖</h3><h4 id="3-3-1-什么是传递性依赖"><a href="#3-3-1-什么是传递性依赖" class="headerlink" title="3.3.1 什么是传递性依赖"></a>3.3.1 什么是传递性依赖</h4><p>Mavan会解析各个直接依赖的POM，将必要的间接以来，以传递性以来的形式引入到当前的项目中。如项目依赖spring-core，sprng-core又依赖commons-logging，那commons-logging就会成为当前项目的依赖范围。</p>
<h4 id="3-3-2-传递性依赖和依赖范围"><a href="#3-3-2-传递性依赖和依赖范围" class="headerlink" title="3.3.2 传递性依赖和依赖范围"></a>3.3.2 传递性依赖和依赖范围</h4><p>依赖范围不仅控制依赖与三种classpath的关系，还会对传递性依赖产生影响。最左边一列表示直接依赖范围，第一行表示第二直接依赖范围。  </p>
<table>
<thead>
<tr>
<th></th>
<th>compile</th>
<th>test</th>
<th>provided</th>
<th>runtime</th>
</tr>
</thead>
<tbody>
<tr>
<td>compile</td>
<td>compile</td>
<td>-</td>
<td>-</td>
<td>runtime</td>
</tr>
<tr>
<td>test</td>
<td>test</td>
<td>-</td>
<td>-</td>
<td>test</td>
</tr>
<tr>
<td>provided</td>
<td>provided</td>
<td>-</td>
<td>provided</td>
<td>provided</td>
</tr>
<tr>
<td>runtime</td>
<td>runtime</td>
<td>-</td>
<td>-</td>
<td>runtime</td>
</tr>
</tbody>
</table>
<h3 id="3-4-依赖调解"><a href="#3-4-依赖调解" class="headerlink" title="3.4 依赖调解"></a>3.4 依赖调解</h3><p>当项目的依赖关系中对同一依赖有不同版本的描述，就会发生依赖调节，遵循一下两条原则  </p>
<ul>
<li><strong>路径最近者有限</strong>：如A-&gt;X(1.0)-&gt;C,A-&gt;B-&gt;c-&gt;X(2.0),X(1.0)长度为2,X(2.0)长度为4,Maven会选择最近的X(1.0)</li>
<li><strong>第一声明者优先</strong>：当依赖路径长度相等的前提下，在POM中依赖声明中顺序最考前的依赖会被解析使用</li>
</ul>
<h3 id="3-5-可选依赖"><a href="#3-5-可选依赖" class="headerlink" title="3.5 可选依赖"></a>3.5 可选依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></div><div class="line">  ...</div><div class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- declare the dependency to be set as optional --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>sample.ProjectA<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Project-A<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span> <span class="comment">&lt;!-- value will be true or false only --&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure>
<p>该项目中将Project-A声明为可选依赖，如果其他项目依赖该项目并要使用Project-A，就需要显示的声明Project-A的依赖。理想情况下我们不应该使用可选依赖，而是分别创建一个Maven项目。</p>
<h3 id="3-6-实战"><a href="#3-6-实战" class="headerlink" title="3.6 实战"></a>3.6 实战</h3><h4 id="3-6-1-排除依赖"><a href="#3-6-1-排除依赖" class="headerlink" title="3.6.1 排除依赖"></a>3.6.1 排除依赖</h4><p>当项目中的某个类库不稳定会影响到当前项目或者要替换某个传递性依赖时就需要排除依赖。具体是在<code>&lt;dependency&gt;&lt;/dependency&gt;</code>中增加<code>&lt;ecxlusions&gt;&lt;/ecxlusions&gt;</code>标签。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></div><div class="line">  ...</div><div class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>sample.ProjectA<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Project-A<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>compile<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span>  <span class="comment">&lt;!-- declare the exclusion here --&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>sample.ProjectB<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>Project-B<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></div><div class="line">      <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>我们将Project-B排除，注意不需要version，因为groupId和artifactId能唯一确定依赖图中的某个依赖，在以后的Maven解析中，不可能出现groupId和artifactId相同，但是version不同的两个依赖。</p>
<h4 id="3-6-2-归类依赖"><a href="#3-6-2-归类依赖" class="headerlink" title="3.6.2 归类依赖"></a>3.6.2 归类依赖</h4><p>通过使用Maven属性在<code>&lt;version&gt;&lt;/version&gt;</code>标签中使用<code>${springframework.version}</code>来归类依赖</p>
<h4 id="3-6-3-优化依赖"><a href="#3-6-3-优化依赖" class="headerlink" title="3.6.3 优化依赖"></a>3.6.3 优化依赖</h4><p>Maven会自定解析项目的直接依赖和传递性以来，依据股则判断依赖范围，对依赖冲突进行调节确保任何一个构件只有唯一的版本在依赖中存在，最后得到的那些依赖被称为已解析依赖（Resolved Dependency）。</p>
<ul>
<li><code>mvn dependency:list</code>：查看当前项目的已解析依赖</li>
<li><code>mvn dependency:tree</code>：查看当前项目的依赖树</li>
<li><code>mvn dependency:analyze</code>：分析当前项目的依赖</li>
</ul>
<h2 id="4-仓库"><a href="#4-仓库" class="headerlink" title="4. 仓库"></a>4. 仓库</h2><h3 id="4-1-介绍"><a href="#4-1-介绍" class="headerlink" title="4.1 介绍"></a>4.1 介绍</h3><p>Maven在某个位置统一存储所有Maven项目共享的构建，实际的Maven项目将不再各自存储其依赖的文件。</p>
<h3 id="4-2-仓库的布局"><a href="#4-2-仓库的布局" class="headerlink" title="4.2 仓库的布局"></a>4.2 仓库的布局</h3><p>Maven构件的存储路径为：groupId/artifactId/version/artifactId-version[-classifier].packaging。句点分割会被转化成路径分割，如log4j:log4j:1.2.15对应的仓库路径为log4j/log4j/1.2.15/log4j-1.2.15.jar。</p>
<h3 id="4-3-仓库分类"><a href="#4-3-仓库分类" class="headerlink" title="4.3 仓库分类"></a>4.3 仓库分类</h3>
<p>仓库分为两类：本地仓库和远程仓库，优先查找本地仓库是否有构件。远程仓库有两类特殊仓库：中央仓库和私服。</p>
<ul>
<li>中央仓库：Maven核心自带的远程仓库，包含了绝大部分开源构建。默认本地没有Maven需要的构建时会从中央仓库下载。</li>
<li>私服：在局域网内架设的私有仓库服务器，用来代理所有外部的远程仓库，内部项目可以部署到私服上供其他项目使用。</li>
</ul>
<h4 id="4-3-1-本地仓库"><a href="#4-3-1-本地仓库" class="headerlink" title="4.3.1 本地仓库"></a>4.3.1 本地仓库</h4><p>默认情况下,有一个路径名为~/.m2/repository/的仓库，如果用户想要自定义仓库的位置，可以编辑该文件。如：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>D:\java\repository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>默认情况下该文件不存在，用户需要从$M2_HOME/conf/settings.xml复制再编辑，不推荐直接修改全局目录的settings.xml文件，因为每次升级该文件都会被覆盖。</p>
<h4 id="4-3-2-中央仓库"><a href="#4-3-2-中央仓库" class="headerlink" title="4.3.2 中央仓库"></a>4.3.2 中央仓库</h4><p>由于必须有至少一个可用的远程仓库才能在执行Maven命令时下载到需要的构件，可以解压Maven的jar文件，然后访问路径org/apache/maven/model/pom-4.0.0.xml查看pom中央仓库配置。所有的Maven都会继承该超级POM。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>central<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Central Repository<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://repo.maven.apache.org/maven2<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>false<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h4 id="4-3-3-私服"><a href="#4-3-3-私服" class="headerlink" title="4.3.3 私服"></a>4.3.3 私服</h4><p>一种特殊的远程仓库，架设在局域网内。当Maven需要下载构件的时候，先向私服请求，如果私服上不存在，则会从外部的远程仓库下载，缓存在私服上。无法从外部仓库下载到的构件也能从本地上传到私服供大家使用。<br><img src="/2018/08/23/Maven学习笔记/私服的用途.png" alt="私服的用途.png" title=""></p>
<table>
<thead>
<tr>
<th>节省外网带宽</th>
<th>消除对外重复构件的下载</th>
</tr>
</thead>
<tbody>
<tr>
<td>加速Maven构建</td>
<td>Maven的一些内部机制（如快照更新检查）会在执行构建的时候不停地检查远程仓库数据，当配置了很多外部仓库的时候，构建的速度会被大大降低。使用私服时只需要检查局域网内私服的数据</td>
</tr>
<tr>
<td>部署第三方构件</td>
<td>私有构件无法从外部仓库获得，部署到内部仓库，供内部的Maven项目使用</td>
</tr>
<tr>
<td>提高稳定性，增强控制</td>
<td>防止Internet不稳定的时候，Maven构建变得不稳定。一些私服软件（如Nexus）还提供了许多额外的功能，如权限管理、RELEASE/SNAPSHOT区分等，管理员可以对仓库进行一些更高级的控制</td>
</tr>
<tr>
<td>降低中央仓库的负荷</td>
<td>避免对中央仓库重复的下载</td>
</tr>
</tbody>
</table>
<h3 id="4-4-远程仓库的配置"><a href="#4-4-远程仓库的配置" class="headerlink" title="4.4 远程仓库的配置"></a>4.4 远程仓库的配置</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">repositories</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 使用repository申明一个或者多个远程仓库 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">repository</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 仓库唯一标识，重复会覆盖上一个远程仓库 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>...<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 仓库名称 --&gt;</span> </div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>...<span class="tag">&lt;/<span class="name">name</span>&gt;</span> </div><div class="line">        <span class="comment">&lt;!-- 仓库地址，一般来说该地址都是基于http协议 --&gt;</span>   </div><div class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>...<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 重要！控制Maven对于发布版本构件的下载 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">releases</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- true/false 控制发布版本构件的下载 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>...<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 更新策略 daily(默认，每天一次)、never(从不)、always（每次构建）、interval:X（间隔X分钟） --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">updatePolicy</span>&gt;</span>...<span class="tag">&lt;/<span class="name">updatePolicy</span>&gt;</span>  </div><div class="line">            <span class="comment">&lt;!-- 检查检验和文件的策略 warn(默认，校验失败，输出警告信息)、fail（遇到校验和错误就要构建失败）、ignore(忽略校验失败) --&gt;</span>  </div><div class="line">            <span class="tag">&lt;<span class="name">checksumPolicy</span>&gt;</span>...<span class="tag">&lt;/<span class="name">checksumPolicy</span>&gt;</span>    </div><div class="line">        <span class="tag">&lt;/<span class="name">releases</span>&gt;</span></div><div class="line"></div><div class="line">        <span class="comment">&lt;!-- 重要！控制Maven对于快照版本构件的下载 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">snapshots</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- true/false 控制快照版本构件的下载 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">enabled</span>&gt;</span>...<span class="tag">&lt;/<span class="name">enabled</span>&gt;</span>    </div><div class="line">             <span class="comment">&lt;!-- 更新策略 daily(默认，每天一次)、never(从不)、always（每次构建）、interval:X（间隔X分钟） --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">updatePolicy</span>&gt;</span>...<span class="tag">&lt;/<span class="name">updatePolicy</span>&gt;</span>   </div><div class="line">            <span class="comment">&lt;!-- 检查检验和文件的策略 warn(默认，校验失败，输出警告信息)、fail（遇到校验和错误就要构建失败）、ignore(忽略校验失败) --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">checksumPolicy</span>&gt;</span>...<span class="tag">&lt;/<span class="name">checksumPolicy</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">snapshots</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 仓库布局方式 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">layout</span>&gt;</span>default<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></div><div class="line">    ...</div><div class="line"><span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="4-4-1-远程仓库的认证"><a href="#4-4-1-远程仓库的认证" class="headerlink" title="4.4.1 远程仓库的认证"></a>4.4.1 远程仓库的认证</h4><p>大部分远程仓库无需认证就可以访问，但有些时候出于安全方面的考虑，需要提供认证信息才能访问一些远程仓库，如私服等。<br><strong>认证信息必须配置在settings.xml文件中，POM往往被提交到代码仓库中供所有成员访问，为了保证安全写在本机的settings.xml文件</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></div><div class="line">    ...</div><div class="line">    <span class="tag">&lt;<span class="name">servers</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>..<span class="tag">&lt;/<span class="name">id</span>&gt;</span><span class="comment">&lt;!-- 需要提供认证信息才能访问的远程仓库ID，与repository元素的id完全一致 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>...<span class="tag">&lt;/<span class="name">username</span>&gt;</span>    <span class="comment">&lt;!-- 用户名 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>...<span class="tag">&lt;/<span class="name">password</span>&gt;</span>    <span class="comment">&lt;!-- 密码 --&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></div><div class="line">    ...</div><div class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h4 id="4-4-2-部署至远程仓库"><a href="#4-4-2-部署至远程仓库" class="headerlink" title="4.4.2 部署至远程仓库"></a>4.4.2 部署至远程仓库</h4><p>私服的一个作用是部署第三方构件，Maven除了能对项目进行编译、测试、打包之外，还能将项目生成的构建部署到仓库中。  </p>
<ul>
<li><p>1.首先编辑pom文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 写在distributionManagement元素中 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span>    <span class="comment">&lt;!-- 指定发布版本构件的仓库 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>...<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>...<span class="tag">&lt;/<span class="name">name</span>&gt;</span>    <span class="comment">&lt;!-- name是方便人阅读 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>...<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span>    <span class="comment">&lt;!-- 指定快照版本构件的仓库 --&gt;</span></div><div class="line">             <span class="tag">&lt;<span class="name">id</span>&gt;</span>...<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>...<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>...<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">distyibutionManagement</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>2.往远程仓库部署构件时往往需要认真，要配置认证信息</p>
</li>
<li>3.执行 <code>mvn clean deploy</code>，部署到远程仓库</li>
</ul>
<h3 id="4-5-快照版本"><a href="#4-5-快照版本" class="headerlink" title="4.5 快照版本"></a>4.5 快照版本</h3><p>Maven中任何一个项目或者构件都必须有自己的版本，本分分为<strong>发布版</strong>和<strong>快照版</strong>。<br>发布版：稳定，版本值可能是1.0.0、1.3alpha-4、2.0<br>快照版：不稳定，版本值2.1-SNAPSHOT、2.1-20091214.221414-13<br>只需将版本号后加-SNAPSHOT，然后发布到私服中，Maven就会自动为构件打上时间戳，如2.1-20091214.221414-13 表示2009年12月14日22时14分14秒第13次快照。<br>默认情况下，Maven每天检查一次更新（由仓库配置的updatePolicy控制），用户也可以强制让Maven检查更新，如<code>mvn clean install -U</code></p>
<h3 id="4-6-从仓库解析依赖的机制"><a href="#4-6-从仓库解析依赖的机制" class="headerlink" title="4.6 从仓库解析依赖的机制"></a>4.6 从仓库解析依赖的机制</h3><p>当本地仓库没有依赖构件时，Maven会自动从远程仓库下载；当依赖版本为快照版本时，Maven会自动找到最新的快照。其依赖解析机制如下</p>
<ul>
<li>1）依赖范围是system，Maven直接从本地文件系统解析构件。</li>
<li>2）根据依赖坐标计算仓库路径，尝试直接直接从本地仓库寻找构件，如果发现相应构件，则解析成功。</li>
<li>3）本地仓库不存在相应构件的情况下，如果依赖的版本是显式的发布版本构件（如1.0,2.1-beta-1），遍历所有远程仓库，发现后下载并解析使用</li>
<li>4）如果依赖版本是RELEASE和LATEST,则基于更新策略读取所有远程仓库的元数据groupId/artifactId/maven-metadata.xml,将其与本地仓库的对应元数据合并后，计算出RELEASE或LATEST的真实的值，然后基于这个值检查本地和远程仓库,如步骤2）和3）。</li>
<li>5）如果依赖版本是SNAPSHOT，则基于更新策略读取所有远程仓库的元数据groupId/artifactId/version/maven-metadata.xml，将其与本地仓库的对应元数据合并后，得到最新快照版本的值，然后基于该值检查本地仓库和远程仓库。</li>
<li>6）如果最后解析得到的构件版本是时间戳格式的快照，如1.4.1-20091104.121450-121，则复制其时间戳格式文件至非时间戳格式，如SNAPSHOT,并使用该非时间戳格式的构件。<br>当依赖的版本不明晰的时候，如<strong>RELEASE</strong>、<strong>LATEST</strong>和<strong>SNAPSHOT</strong>，Maven需要基于更新远程仓库的更新策略来检查更新。与<code>&lt;release&gt;</code>和<code>&lt;snapshots&gt;</code>中的子元素<code>&lt;enable&gt;</code>和<code>&lt;updatePolicy&gt;</code>有关，只有enable为true才能访问该仓库对应发布版本的构件信息。依赖声明中不推荐使用LATEST和RELEASE，因为Maven随时可能解析到不同的构件，且Maven不会明确告诉用户这样的变化。<br><strong>Maven3不再支持在插件配置中使用LATEST和RELEASE，如果不设置插件版本，其效果和RELEASE一样，Maven只会解析最新的发布版本构件</strong></li>
</ul>
<h3 id="4-7-镜像"><a href="#4-7-镜像" class="headerlink" title="4.7 镜像"></a>4.7 镜像</h3><p>如果仓库X可以提供仓库Y存储的所有内容，那么就可以认为X是Y的一个镜像。使用镜像的目的是提供比中央仓库更快的服务，修改settings.xml如下。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></div><div class="line">...</div><div class="line">    <span class="tag">&lt;<span class="name">mirror</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- mirrorOf代表被代理的地址，该值与前面的repository的id值保持一致，central表示代理中央接口--&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>Nexus aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><code>&lt;mirrorOf&gt;</code>标签的匹配规则如下:</p>
<ul>
<li>*:匹配所有远程仓库</li>
<li>external：*：匹配所有远程仓库，使用localhost和file：//协议的除外。也就是说，匹配所有不在本机上的远程仓库</li>
<li>repo1,repo2：匹配仓库repo1和repo2，逗号分隔</li>
<li><em>,!repo1：匹配除repo1以外的所有远程仓库，感叹号排除<br><em>*镜像完全屏蔽了仓库镜像，当镜像仓库不稳定或者停止服务的时候，Maven仍将无法访问被镜像的仓库，因而无法下载构件</em></em></li>
</ul>
<h3 id="4-8-仓库搜索服务"><a href="#4-8-仓库搜索服务" class="headerlink" title="4.8 仓库搜索服务"></a>4.8 仓库搜索服务</h3><ul>
<li><a href="https://www.sonatype.com" target="_blank" rel="external">Sonatype Nexus</a></li>
<li><a href="https://mvnrepository.com/" target="_blank" rel="external">MVNrepository</a></li>
</ul>
<h2 id="5-生命周期和插件"><a href="#5-生命周期和插件" class="headerlink" title="5. 生命周期和插件"></a>5. 生命周期和插件</h2><h3 id="5-1-生命周期简介"><a href="#5-1-生命周期简介" class="headerlink" title="5.1 生命周期简介"></a>5.1 生命周期简介</h3><p>Maven从大量项目和构建工具中学习和反思，总结了一套高度完善的、易扩展的生命周期。包含项目的清理、初始化、编译、测试、打包、集成测试、验证、部署和站点生成等。<br>Maven的生命周期是抽象的，实际的任务都交由插件来完成。</p>
<h3 id="5-2-生命周期详解"><a href="#5-2-生命周期详解" class="headerlink" title="5.2 生命周期详解"></a>5.2 生命周期详解</h3><h4 id="5-2-1-三套生命周期"><a href="#5-2-1-三套生命周期" class="headerlink" title="5.2.1 三套生命周期"></a>5.2.1 三套生命周期</h4><p>Maven拥有三套相互独立的生命周期，分别为clean、default和site，调用这三者中的一个不会触发其它两个生命周期。</p>
<ul>
<li>clean：清理项目</li>
<li>default：构建项目</li>
<li>site：建立目标站点</li>
</ul>
<p>每个生命周期包含一些<strong>有序阶段</strong>，并且后面的阶段依赖于前面的阶段。如clean生命周期包含pre-clean、clean和post-clean，调用pre-clean的时候，只有pre-clean阶段执行调用clean的时候pre-clean和clean阶段都会执行。</p>
<h4 id="5-2-2-clean生命周期"><a href="#5-2-2-clean生命周期" class="headerlink" title="5.2.2 clean生命周期"></a>5.2.2 clean生命周期</h4><p>clean生命周期的目的是清理项目，它包含三个阶段：</p>
<ul>
<li>pre-clean：执行一些清理前需要完成的工作</li>
<li>clean：清理上一次构建生成的文件</li>
<li>post-clean：执行一些清理后需要完成的工作</li>
</ul>
<h4 id="5-2-3-default生命周期"><a href="#5-2-3-default生命周期" class="headerlink" title="5.2.3 default生命周期"></a>5.2.3 default生命周期</h4><p>default是所有生命周期中的核心，定义了真正构建时所需要执行的所有步骤</p>
<ul>
<li>validate：验证这个项目是否正确，所有必需资源是否可用</li>
<li>initialize：初始化编译的状态，例如：设置一些properties属性，或者创建一些目录</li>
<li>generate-sources：生成所有在编译阶段需要的源代码</li>
<li>process-sources：处理项目主资源文件。一般来说，是对src/main/resources目录的内容进行变量替换等工作后，复制到项目输出的主classpath目录中。</li>
<li>generate-resources：生成这个项目包所有需要包含的资源文件</li>
<li>process-resources：复制并处理资源文件到目标目录，为packaging 打包阶段做好准备</li>
<li>compile：编译项目的主源码，一般来说，是编译src/main/java目录下的Java文件至项目输出的主classpath目录中</li>
<li>process-classes：后置处理编译阶段生成的文件，例如：做java字节码的加强操作</li>
<li>generate-test-sources：生成编译阶段需要的test源代码</li>
<li>process-test-sources：处理项目测试资源文件。一般来说，是对src/main/resources目录的内容进行变量替换等工作后，复制到项目输出的测试classpath目录中。</li>
<li>generate-test-resources：生成test测试需要的资源文件</li>
<li>process-test-resources：复制并处理资源文件到test测试目标目录</li>
<li>test-compile:编译项目的测试代码到指定test目标目录</li>
<li>process-test-classes:后置处理test编译阶段生成的文件，例如：做java字节码的加强操作</li>
<li>test:使用合适的单元测试框架，运行所有测试例子，这些测试用例不应该要求这些代码被打包或者部署才能执行</li>
<li>prepare-package:处理任何需要在正式打包之前要完成的必须的准备工作。这一步的通常结果是解压，处理包版本等</li>
<li>package：打包编译后的代码成可发包格式，例如：jar,war等</li>
<li>pre-integration-test：完成一些在集成测试之前需要做的预处理操作，这通常包括建立需要的环境。</li>
<li>integration-test：处理并部署（deploy）包到集成测试可以运行的环境中</li>
<li>post-integration-test：处理一些集成测试之后的事情，通常包括一些环境的清理工作</li>
<li>verify：做一些对包的验证操作，去检测这个包是一个合法的符合标准的包。</li>
<li>install：将包安装到本地仓库，供本地其他Maven项目使用</li>
<li>deploy：将最终的包复制到远程仓库，供其他开发人员和Maven项目使用</li>
</ul>
<h4 id="5-2-4-site生命周期"><a href="#5-2-4-site生命周期" class="headerlink" title="5.2.4 site生命周期"></a>5.2.4 site生命周期</h4><p>site生命周期的目的是建立和发布项目站点，Maven能够基于POM所包含的信息，自动生成一个友好的站点，方便团队交流和发布项目信息</p>
<ul>
<li>pre-site：执行一些在生成项目站点之前需要完成的工作</li>
<li>site：生成项目站点文档</li>
<li>post-site：执行一些在生成项目站点之后需要完成的工作</li>
<li>site-deploy：将生成的项目站点发布到服务器上</li>
</ul>
<h4 id="5-2-5-命令行与生命周期"><a href="#5-2-5-命令行与生命周期" class="headerlink" title="5.2.5 命令行与生命周期"></a>5.2.5 命令行与生命周期</h4><p>我们前面说过各个生命周期是相互独立的，但一个生命周期的阶段是有前后依赖关系的</p>
<ul>
<li><code>mvn clean</code>：调用clean生命周期的clean阶段，实际执行clean生命周期的pre-clean和clean阶段</li>
<li><code>mvn test</code>：调用default生命周期的test阶段，实际执行default生命周期的validate、initiaalize等直到test的所有阶段</li>
<li><code>mvn clean install</code>：调用clean生命周期的clean阶段和default生命周期的install阶段，实际执行了clean生命周期的pre-clean、clean阶段以及default生命周期的从validate至install的所有阶段。结合了两个生命周期，非常适用于项目构建之前清理项目</li>
<li><code>mvn clean deploy site-deploy</code>：实际执行clean生命周期的pre-clean 和clean ，default生命周期的所有阶段，以及site生命周期的所有阶段</li>
</ul>
<h3 id="5-3-插件目标与绑定"><a href="#5-3-插件目标与绑定" class="headerlink" title="5.3 插件目标与绑定"></a>5.3 插件目标与绑定</h3><p>Maven核心仅仅定义了抽象的生命周期，实际的任务是交由插件完成，生命周期与插件相互绑定，用以完成实际的构建任务。一个插件有多个功能，每个功能就是一个插件目标。通用写法是插件前缀：插件目标。</p>
<h4 id="5-3-1-自定义绑定"><a href="#5-3-1-自定义绑定" class="headerlink" title="5.3.1 自定义绑定"></a>5.3.1 自定义绑定</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-source-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 推荐使用非快照版本 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 配置一个任务 --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 任务id --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>attach-sources<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 绑定的生命周期 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">phase</span>&gt;</span>verify<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!-- 配置插件目标 --&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">goal</span>&gt;</span>jar-no-fork<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="5-4-插件配置"><a href="#5-4-插件配置" class="headerlink" title="5.4 插件配置"></a>5.4 插件配置</h3><h4 id="5-4-1-命令行插件配置"><a href="#5-4-1-命令行插件配置" class="headerlink" title="5.4.1 命令行插件配置"></a>5.4.1 命令行插件配置</h4><p><strong>Maven命令中使用-D参数，并伴随一个参数键=参数值的形式</strong><br>例如：install–Dmaven.test.skip=true，跳过测试</p>
<h4 id="5-4-2-POM中插件全局配置"><a href="#5-4-2-POM中插件全局配置" class="headerlink" title="5.4.2 POM中插件全局配置"></a>5.4.2 POM中插件全局配置</h4><p>我们可以在声明插件的时候，对此插件进行一个全局的配置让所有基于该插件的目标任务都使用这些配置。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- 对插件进行全局设置，不管此插件绑定到什么阶段都使用同样的配置 --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!-- 编译1.7版本的源文件 --&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">source</span>&gt;</span></div><div class="line">                <span class="comment">&lt;!-- 生成与JVM 1.7 兼容的字节码文件 --&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">target</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h4 id="5-4-3-POM中插件任务配置"><a href="#5-4-3-POM中插件任务配置" class="headerlink" title="5.4.3 POM中插件任务配置"></a>5.4.3 POM中插件任务配置</h4><p>除了配置插件的全局参数，我们还可以为某个插件任务配置特定的参数，如输出语句<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">	    <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">		    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-antrun-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">executions</span>&gt;</span></div><div class="line">			    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></div><div class="line">				    <span class="tag">&lt;<span class="name">id</span>&gt;</span>ant-validate<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">				    <span class="tag">&lt;<span class="name">phase</span>&gt;</span>validate<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></div><div class="line">				    <span class="tag">&lt;<span class="name">goals</span>&gt;</span></div><div class="line">				        <span class="tag">&lt;<span class="name">goal</span>&gt;</span>run<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></div><div class="line">				    <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></div><div class="line">				    <span class="tag">&lt;<span class="name">configuraction</span>&gt;</span></div><div class="line">					    <span class="tag">&lt;<span class="name">tasks</span>&gt;</span></div><div class="line">						    <span class="tag">&lt;<span class="name">echo</span>&gt;</span>I'm bound to validate phase.<span class="tag">&lt;/<span class="name">echo</span>&gt;</span></div><div class="line">					    <span class="tag">&lt;/<span class="name">tasks</span>&gt;</span></div><div class="line">				    <span class="tag">&lt;/<span class="name">configuraction</span>&gt;</span></div><div class="line">			    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></div><div class="line">		    <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></div><div class="line">	    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="6-聚合与继承"><a href="#6-聚合与继承" class="headerlink" title="6. 聚合与继承"></a>6. 聚合与继承</h2><h3 id="6-1-聚合"><a href="#6-1-聚合" class="headerlink" title="6.1 聚合"></a>6.1 聚合</h3><p>当我们将项目化作多个模块的时候，我们需要使用聚合，聚合模块与其它模块的目录结构通常有水平或者父子两种关系。<br>//TODO：聚合图<br>先来看一下父子目录结构的POM<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.litianming1024<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 聚合模块的打包方式必须为pom --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">modules</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>moduleA<span class="tag">&lt;/<span class="name">module</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">module</span>&gt;</span>moduleB<span class="tag">&lt;/<span class="name">module</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">modules</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>如果使用平行目录结构，聚合模块的POM需要做相应的修改<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">modules</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>../moduleA<span class="tag">&lt;/<span class="name">module</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">module</span>&gt;</span>../moduleB<span class="tag">&lt;/<span class="name">module</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">modules</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="6-2-继承"><a href="#6-2-继承" class="headerlink" title="6.2 继承"></a>6.2 继承</h3><p>前面说过所有POM实际都继承自超级POM，使用继承的好处就是减少部分重复配置。<br>要使用继承，首先要先定义父项目的POM<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.litianming1024<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-test-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 父模块的打包方式必须为pom --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></div><div class="line">    ...</div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>子模块POM修改为<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">project</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- parent声明父模块,groupId、artifactId、version是必须的 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.litianming1024<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-test-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">        <span class="comment">&lt;!-- 默认值../pom.xml --&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">relativePath</span>&gt;</span>../maven-test-parent/pom.xml<span class="tag">&lt;/<span class="name">relativePath</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span>   </div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span> doms-core <span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">  ...</div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><strong>Maven会首先根据relativePath检查父POM，如果找不到，再从本地仓库查找。relativePath的默认值为../pom.xml</strong><br><strong>在实际的应用中一个聚合POM可能同时又是父POM，这样管理比较方便</strong></p>
<h4 id="6-2-1-可继承的POM元素"><a href="#6-2-1-可继承的POM元素" class="headerlink" title="6.2.1 可继承的POM元素"></a>6.2.1 可继承的POM元素</h4><ul>
<li>groupId ：项目组 ID ，项目坐标的核心元素；</li>
<li>version ：项目版本，项目坐标的核心元素；</li>
<li>description ：项目的描述信息；</li>
<li>organization ：项目的组织信息；</li>
<li>inceptionYear ：项目的创始年份；</li>
<li>url ：项目的 url 地址</li>
<li>develoers ：项目的开发者信息；</li>
<li>contributors ：项目的贡献者信息；</li>
<li>distributionManagerment ：项目的部署信息；</li>
<li>issueManagement ：缺陷跟踪系统信息；</li>
<li>ciManagement ：项目的持续继承信息；</li>
<li>scm ：项目的版本控制信息；</li>
<li>mailingListserv ：项目的邮件列表信息；</li>
<li>properties ：自定义的 Maven 属性；</li>
<li>dependencies ：项目的依赖配置；</li>
<li>dependencyManagement ：醒目的依赖管理配置；</li>
<li>repositories ：项目的仓库配置；</li>
<li>build ：包括项目的源码目录配置、输出目录配置、插件配置、插件管理配置等；</li>
<li>reporting ：包括项目的报告输出目录配置、报告插件配置等。</li>
</ul>
<h4 id="6-2-2-依赖管理"><a href="#6-2-2-依赖管理" class="headerlink" title="6.2.2 依赖管理"></a>6.2.2 依赖管理</h4><p>由于dependencies也可以被继承，但有时子模块不会用到父模块的所有依赖，这时我们可以使用dependencyManagement元素来管理依赖配置。该元素的依赖声明<strong>不会引入实际的依赖，但是能够约束dependencies下的依赖使用</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 将spring的版本约束在2.5.6 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">springframework.version</span>&gt;</span>2.5.6<span class="tag">&lt;/<span class="name">springframework.version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;springframework.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><span id="import">import：</span><br>如果想要导入合并某个POM中的dependencyManagement配置，我们需要用到import的范围依赖,如<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.github.litianming1024<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>other<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">            <span class="comment">&lt;!-- type必须为pom --&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">type</span>&gt;</span>pom<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">type</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>import<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;/<span class="name">scope</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h4 id="6-2-3-插件管理"><a href="#6-2-3-插件管理" class="headerlink" title="6.2.3 插件管理"></a>6.2.3 插件管理</h4><p>Maven也提供了pluginManagement元素帮助管理插件，<strong>该元素不会造成实际的插件调用行为，只是当POM中配置了真正的plugin元素，并且其groupId和artifactId与pluginManagement中配置的插件匹配时才会影响行为</strong>。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-resources-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">                    <span class="tag">&lt;<span class="name">encoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">encoding</span>&gt;</span></div><div class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="7-使用Maven进行测试"><a href="#7-使用Maven进行测试" class="headerlink" title="7. 使用Maven进行测试"></a>7. 使用Maven进行测试</h2><h3 id="7-1-跳过测试"><a href="#7-1-跳过测试" class="headerlink" title="7.1 跳过测试"></a>7.1 跳过测试</h3><h4 id="7-1-1-仅跳过单元测试"><a href="#7-1-1-仅跳过单元测试" class="headerlink" title="7.1.1 仅跳过单元测试"></a>7.1.1 仅跳过单元测试</h4><p>命令：<code>mvn package -DskipTests</code><br>POM文件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </div><div class="line">        <span class="tag">&lt;<span class="name">skipTests</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skipTests</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span>  </div><div class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h4 id="7-1-2-跳过单元测试编译和测试"><a href="#7-1-2-跳过单元测试编译和测试" class="headerlink" title="7.1.2 跳过单元测试编译和测试"></a>7.1.2 跳过单元测试编译和测试</h4><p>命令：<code>mvn package -Dmaven.test.skip=true</code><br>POM文件：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-compiler-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </div><div class="line">        <span class="tag">&lt;<span class="name">skip</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skip</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span>  </div><div class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>  </div><div class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-surefire-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span>  </div><div class="line">        <span class="tag">&lt;<span class="name">skip</span>&gt;</span>true<span class="tag">&lt;/<span class="name">skip</span>&gt;</span>  </div><div class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span>  </div><div class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="8-灵活构建"><a href="#8-灵活构建" class="headerlink" title="8. 灵活构建"></a>8. 灵活构建</h2><h3 id="8-1-Maven属性"><a href="#8-1-Maven属性" class="headerlink" title="8.1 Maven属性"></a>8.1 Maven属性</h3><p>Maven有6类属性：</p>
<ul>
<li>内置属性：主要两个内置属性——\${basedir}表示项目根目录，即包含pom.xml文件的目录；\${version}标识项目版本。</li>
<li>POM属性：可以使用该类属性引用POM文件中对应元素的值，例如${project.artifactId}对应了\<project>\<artifactid>元素的值<br>常见的POM属性包括：  <pre>
  ${project.build.sourceDirectory}:项目的主源码目录，默认为src/main/java/.
  ${project.build.testSourceDirectory}:项目的测试源码目录，默认为/src/test/java/.
  ${project.build.directory}:项目构建输出目录，默认为target/.
  ${project.build.outputDirectory}:项目主代码编译输出目录，默认为target/classes/.
  ${project.build.testOutputDirectory}:项目测试代码编译输出目录，默认为target/testclasses/.
  ${project.groupId}:项目的groupId.
  ${project.artifactId}:项目的artifactId.
  ${project.version}:项目的version,等同于${version}
  ${project.build.finalName}:项目打包输出文件的名称，默认为${project.artifactId}${project.version}.
  </pre></artifactid></project></li>
<li><p>自定义属性：在POM的\<properties>元素下定义自定义Maven属性。如</properties></p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- swagger.version --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">swagger.version</span>&gt;</span>2.2.2<span class="tag">&lt;/<span class="name">swagger.version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>Settings属性：跟pom属性同理，使用setting开头，引用setting.xml文件中xml元素的值</p>
</li>
<li>Java系统属性：所有的java系统属性都可以使用Maven属性引用，如\&amp;{user.home}指向了用户目录</li>
<li>环境变量属性：所有环境变量都可以使用以env.开头的Maven属性引用。如：\${env.JAVAHOME}指代了JAVA_HOME环境变量的值。可以使用<code>mvn help:system</code>来查看所有的环境变量。</li>
</ul>
<h3 id="8-2-构建环境的差异"><a href="#8-2-构建环境的差异" class="headerlink" title="8.2 构建环境的差异"></a>8.2 构建环境的差异</h3><p>在不同的环境中，项目的源码应该使用不同的方式进行构建。最常见的就是数据库配置。</p>
<h3 id="8-3-资源过滤"><a href="#8-3-资源过滤" class="headerlink" title="8.3 资源过滤"></a>8.3 资源过滤</h3><p>为了应对环境的变化，我们需要将会发生变化的部分提取出来。一般会在src/main/resources目录下添加数据库的配置文件.properties文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">database.jdbc.driverClass=$&#123;db.driver&#125;</div><div class="line">database.jdbc.connectionURL=$&#123;db.url&#125;</div><div class="line">database.jdbc.username=$&#123;db.username&#125;</div><div class="line">database.jdbc.password=$&#123;db.password&#125;</div></pre></td></tr></table></figure></p>
<p>我们使用profile在POM中包起来<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span>     </div><div class="line">          <span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">               <span class="tag">&lt;<span class="name">db.driver</span>&gt;</span>com.mysql.jdbc.Driver<span class="tag">&lt;/<span class="name">db.driver</span>&gt;</span></div><div class="line">               <span class="tag">&lt;<span class="name">db.url</span>&gt;</span>jdbc:mysql://192.168.1.100:3306/test<span class="tag">&lt;/<span class="name">db.url</span>&gt;</span></div><div class="line">               <span class="tag">&lt;<span class="name">db.username</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">db.username</span>&gt;</span></div><div class="line">               <span class="tag">&lt;<span class="name">db.password</span>&gt;</span>dew-pwd<span class="tag">&lt;/<span class="name">db.password</span>&gt;</span></div><div class="line">          <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line">     <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>但是这仅仅不够，<strong>Maven属性默认只有在POM中才会被解析</strong>，上面的properties属性仍然没有被填充，为了解决这个问题我们需要定制maven-resources-plugin开启资源过滤<br>为主资源目录开启过滤：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">resources</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">resource</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.basedir&#125;/src/main/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></div><div class="line">     <span class="tag">&lt;/<span class="name">resource</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">resouces</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>同样为测试资源开启过滤：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">testResources</span>&gt;</span></div><div class="line">     <span class="tag">&lt;<span class="name">testResource</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">directory</span>&gt;</span>$&#123;project.basedir&#125;/src/test/resources<span class="tag">&lt;/<span class="name">directory</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">filtering</span>&gt;</span>true<span class="tag">&lt;/<span class="name">filtering</span>&gt;</span></div><div class="line">     <span class="tag">&lt;/<span class="name">testResource</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">testResouces</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>主资源目录和测试资源目录都可以超过一个<br>属性激活：<code>mvn clean install -Pdev</code> -P参数表示激活的profile</p>
<h3 id="8-4-Maven-Profile"><a href="#8-4-Maven-Profile" class="headerlink" title="8.4 Maven Profile"></a>8.4 Maven Profile</h3><p>在不同环境下的构建很可能是不同的，典型的情况就是数据库的配置。除此之外，有些环境可能需要配置插件执行一些特殊的操作，或者使用特殊版本的依赖，或者需要一个特殊的构件名称。为了能让构建在各个环境下方便地移植，Maven引入了profile的概念。profile能够在构建的时候修改POM的一个子集，或者添加额外的配置元素。用户可以使用很多方式激活profile，以实现构建在不同环境下的移植。</p>
<h4 id="8-4-1-激活profile"><a href="#8-4-1-激活profile" class="headerlink" title="8.4.1 激活profile"></a>8.4.1 激活profile</h4><ol>
<li>命令激活<br>用户可以使用mvn命令行参数-P加上profile的id来激活profile，多个id之间以逗号分隔。例如，下面的命令激活了dev-x和dev-y两个profile：<br><code>mvn clean install -Pdev-x, dev-y</code></li>
<li><p>settings文件显式激活<br>如果用户希望某个profile默认一直处于激活状态，就可以配置settings.xml文件的activeProfiles元素，表示其配置的profile对于所有项目都处于激活状态，代码如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></div><div class="line">     ...</div><div class="line">     <span class="tag">&lt;<span class="name">activeProfiles</span>&gt;</span></div><div class="line">          <span class="tag">&lt;<span class="name">activeProfile</span>&gt;</span>dev-x<span class="tag">&lt;/<span class="name">activeProfile</span>&gt;</span></div><div class="line">     <span class="tag">&lt;/<span class="name">activeProfiles</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>系统属性激活<br>用户可以配置当某系统属性存在或者为特定值的时候自动激活profile，如test为x</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">property</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">name</span>&gt;</span>test<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">value</span>&gt;</span>x<span class="tag">&lt;/<span class="name">value</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></div><div class="line">``` </div><div class="line"></div><div class="line">不要忘了用户可以在命令行声明系统属性  </div><div class="line">`mvn clean install -Dtest=x`</div><div class="line">   </div><div class="line">4. 操作系统环境激活  </div><div class="line">5. 文件存在与否激活  </div><div class="line">6. 默认激活  </div><div class="line">定义profile的时候指定其默认激活</div><div class="line"></div><div class="line">```xml</div><div class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>dev<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">activation</span>&gt;</span></div><div class="line">           <span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">activation</span>&gt;</span></div><div class="line">        ...</div><div class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>如果POM中有任何一个profile通过以上其他任意一种方式被激活，所有的默认激活配置都会失效</strong><br>了解当前激活的profile:<code>mvn help:active-profiles</code><br>列出当前所有的profile:<code>mvn help:all-profiles</code></p>
<h4 id="8-4-2-profile的种类"><a href="#8-4-2-profile的种类" class="headerlink" title="8.4.2 profile的种类"></a>8.4.2 profile的种类</h4><p>根据具体的需要，可以在以下位置声明profile：</p>
<ul>
<li>pom.xml：pom.xml中声明的profile只对当前项目有效。</li>
<li>用户settings.xml：用户目录下.m2/settings.xml中的profile对本机上该用户所有的Maven项目有效。</li>
<li>全局settings.xml：Maven安装目录下conf/settings.xml中的profile对本机上所有的Maven项目有效，不建议使用。</li>
</ul>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><ul>
<li>《Maven实战》</li>
<li><a href="http://ifeve.com/introduction-to-optional-and-excludes-dependencies/" target="_blank" rel="external">Maven官方指南</a></li>
</ul>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Maven/" rel="tag"># Maven</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/12/05/MySQL自定义变量小结/" rel="next" title="MySQL自定义变量小结">
                <i class="fa fa-chevron-left"></i> MySQL自定义变量小结
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/02/缓存使用系列/" rel="prev" title="缓存使用系列">
                缓存使用系列 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zMTAyOC83NTc3"></div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          
            <p class="site-author-name" itemprop="name">天明</p>
            <p class="site-description motion-element" itemprop="description"></p>
        </div>

        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
            
              <a href="/archives/">
            
                <span class="site-state-item-count">9</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/litianming1024" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>GitHub</a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Maven学习笔记"><span class="nav-number">1.</span> <span class="nav-text">Maven学习笔记</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-是什么"><span class="nav-number">1.1.</span> <span class="nav-text">1. 是什么</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-入门"><span class="nav-number">1.2.</span> <span class="nav-text">2. 入门</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-坐标和依赖"><span class="nav-number">1.3.</span> <span class="nav-text">3. 坐标和依赖</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-入门"><span class="nav-number">1.3.1.</span> <span class="nav-text">3.1 入门</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-详解"><span class="nav-number">1.3.2.</span> <span class="nav-text">3.2 详解</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-2-1-scope详解"><span class="nav-number">1.3.2.1.</span> <span class="nav-text">3.2.1 scope详解</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-传递性依赖"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.3 传递性依赖</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-1-什么是传递性依赖"><span class="nav-number">1.3.3.1.</span> <span class="nav-text">3.3.1 什么是传递性依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-3-2-传递性依赖和依赖范围"><span class="nav-number">1.3.3.2.</span> <span class="nav-text">3.3.2 传递性依赖和依赖范围</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-依赖调解"><span class="nav-number">1.3.4.</span> <span class="nav-text">3.4 依赖调解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-可选依赖"><span class="nav-number">1.3.5.</span> <span class="nav-text">3.5 可选依赖</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-实战"><span class="nav-number">1.3.6.</span> <span class="nav-text">3.6 实战</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-1-排除依赖"><span class="nav-number">1.3.6.1.</span> <span class="nav-text">3.6.1 排除依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-2-归类依赖"><span class="nav-number">1.3.6.2.</span> <span class="nav-text">3.6.2 归类依赖</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-6-3-优化依赖"><span class="nav-number">1.3.6.3.</span> <span class="nav-text">3.6.3 优化依赖</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-仓库"><span class="nav-number">1.4.</span> <span class="nav-text">4. 仓库</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-介绍"><span class="nav-number">1.4.1.</span> <span class="nav-text">4.1 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-仓库的布局"><span class="nav-number">1.4.2.</span> <span class="nav-text">4.2 仓库的布局</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-仓库分类"><span class="nav-number">1.4.3.</span> <span class="nav-text">4.3 仓库分类</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-1-本地仓库"><span class="nav-number">1.4.3.1.</span> <span class="nav-text">4.3.1 本地仓库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-2-中央仓库"><span class="nav-number">1.4.3.2.</span> <span class="nav-text">4.3.2 中央仓库</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-3-3-私服"><span class="nav-number">1.4.3.3.</span> <span class="nav-text">4.3.3 私服</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4-远程仓库的配置"><span class="nav-number">1.4.4.</span> <span class="nav-text">4.4 远程仓库的配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-1-远程仓库的认证"><span class="nav-number">1.4.4.1.</span> <span class="nav-text">4.4.1 远程仓库的认证</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-4-2-部署至远程仓库"><span class="nav-number">1.4.4.2.</span> <span class="nav-text">4.4.2 部署至远程仓库</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-快照版本"><span class="nav-number">1.4.5.</span> <span class="nav-text">4.5 快照版本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-从仓库解析依赖的机制"><span class="nav-number">1.4.6.</span> <span class="nav-text">4.6 从仓库解析依赖的机制</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-7-镜像"><span class="nav-number">1.4.7.</span> <span class="nav-text">4.7 镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-8-仓库搜索服务"><span class="nav-number">1.4.8.</span> <span class="nav-text">4.8 仓库搜索服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-生命周期和插件"><span class="nav-number">1.5.</span> <span class="nav-text">5. 生命周期和插件</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-生命周期简介"><span class="nav-number">1.5.1.</span> <span class="nav-text">5.1 生命周期简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-生命周期详解"><span class="nav-number">1.5.2.</span> <span class="nav-text">5.2 生命周期详解</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-1-三套生命周期"><span class="nav-number">1.5.2.1.</span> <span class="nav-text">5.2.1 三套生命周期</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-2-clean生命周期"><span class="nav-number">1.5.2.2.</span> <span class="nav-text">5.2.2 clean生命周期</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-3-default生命周期"><span class="nav-number">1.5.2.3.</span> <span class="nav-text">5.2.3 default生命周期</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-4-site生命周期"><span class="nav-number">1.5.2.4.</span> <span class="nav-text">5.2.4 site生命周期</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-2-5-命令行与生命周期"><span class="nav-number">1.5.2.5.</span> <span class="nav-text">5.2.5 命令行与生命周期</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3-插件目标与绑定"><span class="nav-number">1.5.3.</span> <span class="nav-text">5.3 插件目标与绑定</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-3-1-自定义绑定"><span class="nav-number">1.5.3.1.</span> <span class="nav-text">5.3.1 自定义绑定</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4-插件配置"><span class="nav-number">1.5.4.</span> <span class="nav-text">5.4 插件配置</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#5-4-1-命令行插件配置"><span class="nav-number">1.5.4.1.</span> <span class="nav-text">5.4.1 命令行插件配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-4-2-POM中插件全局配置"><span class="nav-number">1.5.4.2.</span> <span class="nav-text">5.4.2 POM中插件全局配置</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-4-3-POM中插件任务配置"><span class="nav-number">1.5.4.3.</span> <span class="nav-text">5.4.3 POM中插件任务配置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-聚合与继承"><span class="nav-number">1.6.</span> <span class="nav-text">6. 聚合与继承</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1-聚合"><span class="nav-number">1.6.1.</span> <span class="nav-text">6.1 聚合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2-继承"><span class="nav-number">1.6.2.</span> <span class="nav-text">6.2 继承</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-1-可继承的POM元素"><span class="nav-number">1.6.2.1.</span> <span class="nav-text">6.2.1 可继承的POM元素</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-2-依赖管理"><span class="nav-number">1.6.2.2.</span> <span class="nav-text">6.2.2 依赖管理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-2-3-插件管理"><span class="nav-number">1.6.2.3.</span> <span class="nav-text">6.2.3 插件管理</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-使用Maven进行测试"><span class="nav-number">1.7.</span> <span class="nav-text">7. 使用Maven进行测试</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-跳过测试"><span class="nav-number">1.7.1.</span> <span class="nav-text">7.1 跳过测试</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1-1-仅跳过单元测试"><span class="nav-number">1.7.1.1.</span> <span class="nav-text">7.1.1 仅跳过单元测试</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-1-2-跳过单元测试编译和测试"><span class="nav-number">1.7.1.2.</span> <span class="nav-text">7.1.2 跳过单元测试编译和测试</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-灵活构建"><span class="nav-number">1.8.</span> <span class="nav-text">8. 灵活构建</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-Maven属性"><span class="nav-number">1.8.1.</span> <span class="nav-text">8.1 Maven属性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-构建环境的差异"><span class="nav-number">1.8.2.</span> <span class="nav-text">8.2 构建环境的差异</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-资源过滤"><span class="nav-number">1.8.3.</span> <span class="nav-text">8.3 资源过滤</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-4-Maven-Profile"><span class="nav-number">1.8.4.</span> <span class="nav-text">8.4 Maven Profile</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-1-激活profile"><span class="nav-number">1.8.4.1.</span> <span class="nav-text">8.4.1 激活profile</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#8-4-2-profile的种类"><span class="nav-number">1.8.4.2.</span> <span class="nav-text">8.4.2 profile的种类</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考资料"><span class="nav-number">1.9.</span> <span class="nav-text">参考资料</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2017 &mdash; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">天明</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动</div>

  <span class="post-meta-divider">|</span>

  <div class="theme-info">主题 &mdash; <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.2</div>


        


<script>
  	var _mtac = {};
  	(function() {
  		var mta = document.createElement("script");
  		mta.src = "https://pingjs.qq.com/h5/stats.js?v2.0.4";
  		mta.setAttribute("name", "MTAH5");
  		mta.setAttribute("sid", "500527581");

  		var s = document.getElementsByTagName("script")[0];
  		s.parentNode.insertBefore(mta, s);
  	})();
</script>



  <script type="text/javascript">
    (function() {
      var hm = document.createElement("script");
      hm.src = "//tajs.qq.com/stats?sId=63752005";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.2"></script>



  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>


  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  








  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("jiHfwcJtEphKAriEGeMG8IYq-gzGzoHsz", "XPJ6sD8gmhxHgptIOe9rtgCK");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  

  

</body>
</html>
